{% extends "base.html" %}

{% block title %}Submit Anonymous Report - Whistleblower Portal{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header bg-primary text-white text-center py-4">
                    <h2 class="mb-0">
                        <i class="fas fa-plus-circle me-2"></i>Submit Anonymous Report
                    </h2>
                    <p class="mb-0 mt-2">Your identity will remain completely confidential</p>
                </div>
                <div class="card-body p-5">
                    <div class="alert alert-info mb-4">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Important:</strong> This form is completely anonymous. No personal information is required or collected. 
                        Designed specifically for plantation and agricultural workers to report safety, welfare, and workplace concerns.
                    </div>
                    
                    <div class="d-flex justify-content-end mb-3">
                      <form method="get" id="langForm">
                        <select name="lang" id="langSelect" class="form-select form-select-sm" style="width:auto; display:inline-block;">
                          <option value="en" {% if lang == 'en' %}selected{% endif %}>English</option>
                          <option value="sw" {% if lang == 'sw' %}selected{% endif %}>Swahili</option>
                        </select>
                      </form>
                    </div>

                    <form method="POST">
                        <!-- Section: About the Incident -->
                        <h5 class="mb-3 mt-2"><i class="fas fa-info-circle me-2"></i>About the Incident</h5>
                        <div class="mb-4">
                            <label for="title" class="form-label fw-bold">
                                <i class="fas fa-heading me-2"></i>Report Title
                                <span data-bs-toggle="tooltip" title="A brief, descriptive title for your report.">
                                    <i class="fas fa-question-circle text-muted"></i>
                                </span>
                            </label>
                            <input type="text" class="form-control form-control-lg" id="title" name="title" 
                                   placeholder="e.g. Unethical behavior in procurement" required>
                        </div>
                        
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label for="date_of_incident" class="form-label fw-bold">
                                    <i class="fas fa-calendar-alt me-2"></i>Date of Incident
                                    <span data-bs-toggle="tooltip" title="When did the incident occur?">
                                        <i class="fas fa-question-circle text-muted"></i>
                                    </span>
                                </label>
                                <input type="date" class="form-control" id="date_of_incident" name="date_of_incident" required>
                            </div>
                            <div class="col-md-6">
                                <label for="location" class="form-label fw-bold">
                                    <i class="fas fa-map-marker-alt me-2"></i>Location
                                    <span data-bs-toggle="tooltip" title="Where did the incident happen? (e.g. Office 3B, Warehouse)">
                                        <i class="fas fa-question-circle text-muted"></i>
                                    </span>
                                </label>
                                <input type="text" class="form-control" id="location" name="location" placeholder="e.g. Main Office, Floor 2" required>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="department" class="form-label fw-bold">
                                <i class="fas fa-building me-2"></i>Department/Area
                                <span data-bs-toggle="tooltip" title="Which department or area is involved?">
                                    <i class="fas fa-question-circle text-muted"></i>
                                </span>
                            </label>
                            <select class="form-select" id="department" name="department" required>
                                <option value="">Select department/area</option>
                                <option value="Finance">Finance</option>
                                <option value="HR">HR</option>
                                <option value="IT">IT</option>
                                <option value="Procurement">Procurement</option>
                                <option value="Operations">Operations</option>
                                <option value="Sales">Sales</option>
                                <option value="Logistics">Logistics</option>
                                <option value="Legal">Legal</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <!-- Section: Details -->
                        <h5 class="mb-3 mt-4"><i class="fas fa-file-alt me-2"></i>Details</h5>
                        <div class="mb-4">
                            <label for="category" class="form-label fw-bold">
                                <i class="fas fa-tags me-2"></i>Category
                                <span data-bs-toggle="tooltip" title="Type of issue you are reporting.">
                                    <i class="fas fa-question-circle text-muted"></i>
                                </span>
                            </label>
                            <select class="form-select form-select-lg" id="category" name="category" required>
                            <option value="">Select a category</option>
                            <option value="Financial Misconduct">Financial Misconduct</option>
                            <option value="Harassment">Harassment</option>
                            <option value="Substance Abuse">Substance Abuse</option>
                            <option value="Safety Violations">Safety Violations</option>
                            <option value="Ethical Violations">Ethical Violations</option>
                            <option value="Legal Violations">Legal Violations</option>
                            <option value="Data Privacy">Data Privacy</option>
                            <option value="Environmental">Environmental</option>
                            <option value="Child Labor">Child Labor</option>
                            <option value="Workplace Welfare">Workplace Welfare</option>
                            <option value="Domestic or Family Issues">Domestic or Family Issues</option>
                            <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div class="mb-4">
                            <label for="description" class="form-label fw-bold">
                                <i class="fas fa-file-alt me-2"></i>Detailed Description
                                <span data-bs-toggle="tooltip" title="Describe what happened, who was involved, and any evidence.">
                                    <i class="fas fa-question-circle text-muted"></i>
                                </span>
                            </label>
                            <textarea class="form-control" id="description" name="description" rows="8" 
                                      placeholder="Describe your concern by answering these questions:
• What happened? (Describe the event or issue)
• When did it happen? (Date and time, if known)
• Where did it happen? (Location, department, area)
• Who was involved? (Names, roles, or descriptions if known)
• How did you find out? (Did you witness it, hear about it, etc.)
• Is there any evidence? (Documents, photos, emails, etc.)
• Has this happened before? (If yes, how often?)
• Any other details you think are important?" required></textarea>
                            <div class="form-text">
                                Be as detailed as possible while maintaining anonymity. Include relevant dates, locations, and any supporting information.
                            </div>
                        </div>
                        
                        <!-- Section: Urgency -->
                        <h5 class="mb-3 mt-4"><i class="fas fa-exclamation-triangle me-2"></i>Urgency</h5>
                        <div class="mb-4">
                            <label for="priority" class="form-label fw-bold">
                                <i class="fas fa-exclamation-triangle me-2"></i>Priority Level
                                <span data-bs-toggle="tooltip" title="How urgent is this issue?">
                                    <i class="fas fa-question-circle text-muted"></i>
                                </span>
                            </label>
                            <select class="form-select form-select-lg" id="priority" name="priority" required>
                                <option value="">Select priority level</option>
                                <option value="Low">Low - General concern</option>
                                <option value="Medium">Medium - Requires attention</option>
                                <option value="High">High - Urgent attention needed</option>
                                <option value="Critical">Critical - Immediate action required</option>
                            </select>
                        </div>
                        
                        <div class="alert alert-warning mb-4">
                            <i class="fas fa-shield-alt me-2"></i>
                            <strong>Security Reminder:</strong> 
                            <ul class="mb-0 mt-2">
                                <li>Do not include any personal identifying information</li>
                                <li>Use general descriptions rather than specific names when possible</li>
                                <li>Focus on facts and evidence rather than opinions</li>
                            </ul>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-paper-plane me-2"></i>Submit Report
                            </button>
                            <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Back to Home
                            </a>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Information Cards -->
            <div class="row mt-5 g-4">
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-qrcode text-primary mb-3" style="font-size: 2rem;"></i>
                            <h5 class="card-title">Tracking Code</h5>
                            <p class="card-text">After submission, you'll receive a unique tracking code to monitor your report's progress.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-user-secret text-primary mb-3" style="font-size: 2rem;"></i>
                            <h5 class="card-title">Complete Anonymity</h5>
                            <p class="card-text">Your identity is never collected or stored. Reports are processed anonymously.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Enable Bootstrap tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.forEach(function (tooltipTriggerEl) {
        new bootstrap.Tooltip(tooltipTriggerEl);
    });

    // Auto-resize textarea
    const textarea = document.getElementById('description');
    textarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = this.scrollHeight + 'px';
    });
    
    // Form validation
    const form = document.querySelector('form');
    form.addEventListener('submit', function(e) {
        const title = document.getElementById('title').value.trim();
        const description = document.getElementById('description').value.trim();
        const date = document.getElementById('date_of_incident').value;
        const location = document.getElementById('location').value.trim();
        const department = document.getElementById('department').value;
        
        // Only require that title is not empty
        if (!title) {
            e.preventDefault();
            alert('Please provide a title for your report.');
            return;
        }
        if (!date) {
            e.preventDefault();
            alert('Please select the date of the incident.');
            return;
        }
        if (!location) {
            e.preventDefault();
            alert('Please provide the location of the incident.');
            return;
        }
        if (!department) {
            e.preventDefault();
            alert('Please select the department or area involved.');
            return;
        }
    });

    document.getElementById('langSelect').addEventListener('change', function() {
      document.getElementById('langForm').submit();
    });
});
</script>
{% endblock %}